# Import/Export Documentation

This document provides comprehensive information about the Import/Export functionality in the deSEC Qt DNS Manager, which allows you to backup, migrate, and manage DNS configurations in various standard formats.

## Overview

The Import/Export feature enables you to:
- **Export** DNS zones and records to files in multiple formats
- **Import** DNS configurations from external sources
- **Backup** your DNS configurations for disaster recovery
- **Migrate** between different DNS providers or environments
- **Version control** your DNS configurations using Infrastructure-as-Code workflows

## Supported Formats

### 1. JSON (API-compatible)
- **Use Case**: Direct API compatibility, backups, programmatic processing
- **Features**: Complete metadata preservation, deSEC API format
- **File Extension**: `.json`
- **Best For**: Backups, API integration, data processing

### 2. YAML (Infrastructure-as-Code)
- **Use Case**: Infrastructure-as-Code workflows, version control, human-readable configs
- **Features**: Clean syntax, comments support, Git-friendly
- **File Extension**: `.yaml`, `.yml`
- **Best For**: DevOps workflows, configuration management, documentation

### 3. BIND Zone Files
- **Use Case**: Traditional DNS server configurations, industry standard
- **Features**: Standard RFC-compliant format, widely supported
- **File Extension**: `.zone`, `.txt`
- **Best For**: Migration from BIND servers, DNS server configurations

### 4. djbdns/tinydns Format
- **Use Case**: djbdns/tinydns server configurations
- **Features**: Compact format, specific to djbdns ecosystem
- **File Extension**: `.data`, `.txt`
- **Best For**: djbdns/tinydns server setups

## Accessing Import/Export

1. **From Main Menu**: `File → Import/Export...`
2. **Keyboard Shortcut**: None (accessed via menu)
3. **Requirements**: Active internet connection for import operations

## Export Functionality

### How to Export a Zone

1. **Open Import/Export Dialog**
   - Go to `File → Import/Export...`
   - Select the **Export** tab

2. **Configure Export Settings**
   - **Zone Selection**: Choose the zone to export from the dropdown
   - **Format**: Select your desired export format (JSON, YAML, BIND, djbdns)
   - **Options**: 
     - ✅ **Include metadata**: Preserves timestamps and API metadata
     - ❌ **Include metadata**: Exports only essential DNS data

3. **Choose Output File**
   - Click **Browse...** to select the output file location
   - File extension will be suggested based on selected format

4. **Export**
   - Click **Export Zone** to start the process
   - Progress will be shown with a progress bar
   - Success/error messages will be displayed

### Export Options Explained

#### Include Metadata
- **Enabled**: Exports complete zone/record information including:
  - Creation timestamps (`created`)
  - Last modification timestamps (`touched`)
  - Publication timestamps (`published`)
  - API-specific fields
- **Disabled**: Exports only essential DNS information:
  - Zone name and minimum TTL
  - Record names, types, TTL values, and content
  - Cleaner for migration to other DNS providers

### Sample Export Formats

#### JSON Export (with metadata)
```json
{
  "format": "deSEC JSON Export",
  "version": "1.0",
  "exported_at": "2025-08-10T06:05:00.000000",
  "zone": {
    "name": "example.com",
    "minimum_ttl": 3600,
    "created": "2025-06-01T10:00:00.000000Z",
    "published": "2025-08-10T05:30:00.000000Z",
    "touched": "2025-08-10T05:30:00.000000Z"
  },
  "records": [
    {
      "subname": "www",
      "type": "A",
      "ttl": 3600,
      "records": ["192.168.1.100"],
      "created": "2025-06-01T10:05:00.000000Z",
      "touched": "2025-08-10T05:30:00.000000Z"
    }
  ]
}
```

#### YAML Export (without metadata)
```yaml
format: deSEC YAML Export
version: '1.0'
exported_at: '2025-08-10T06:05:00.000000'
zone:
  name: example.com
  minimum_ttl: 3600
records:
- subname: www
  type: A
  ttl: 3600
  records:
  - 192.168.1.100
```

#### BIND Zone File Export
```bind
; BIND zone file for example.com
; Generated by deSEC Qt DNS Manager on 2025-08-10T06:05:00.000000

$ORIGIN example.com.
$TTL 3600

@                    3600     IN SOA    ns1.desec.io. admin.example.com. (
                                        2025081001 ; serial
                                        3600       ; refresh
                                        1800       ; retry
                                        604800     ; expire
                                        3600 )     ; minimum

www                  3600     IN A      192.168.1.100
```

#### djbdns/tinydns Export
```
# djbdns/tinydns data file for example.com
# Generated by deSEC Qt DNS Manager on 2025-08-10T06:05:00.000000

+www.example.com:192.168.1.100:3600
```

## Import Functionality

### How to Import a Zone

1. **Open Import/Export Dialog**
   - Go to `File → Import/Export...`
   - Select the **Import** tab

2. **Select Import File**
   - Click **Browse...** to select the file to import
   - Supported file types will be filtered automatically

3. **Configure Import Settings**
   - **Format**: Select the format that matches your file (JSON, YAML, BIND, djbdns)
   - **Target Zone**: Choose where to import the records:
     - Use zone name from import file (default)
     - Select from existing zones dropdown
     - Enter custom zone name
   - **Import Mode**: Select how to handle existing records:
     - **Append** (default): Add new records, keep existing ones
     - **Merge**: Update matching records, preserve non-matching
     - **Replace**: Replace all existing records with imported ones

4. **Preview Import (Recommended)**
   - Click **Preview Import** to validate the file and see what will be imported
   - Review the preview information:
     - Target zone name
     - Number of records to import
     - Import mode and behavior
     - Sample records (first 10 shown)

5. **Import**
   - Click **Import Zone** to proceed with the actual import
   - Review the confirmation dialog showing:
     - Target zone
     - Import mode with clear description
     - Warning for destructive operations (Replace mode)
   - Confirm the operation when prompted
   - Progress will be shown during import with real-time status

### Import Modes

The import functionality provides three modes for handling existing records in the target zone:

#### 1. Append Mode (Default)
- **Behavior**: Add new records, keep existing ones unchanged
- **Use Case**: Safe addition of new records without affecting existing configuration
- **Data Operation**: Similar to appending rows to a dataset
- **Existing Records**: Preserved completely
- **Import Records**: All records are created as new entries
- **Best For**: Adding new subdomains or record types to existing zones

#### 2. Merge Mode
- **Behavior**: Update matching records, preserve non-matching ones
- **Use Case**: Selective updates to existing DNS configuration
- **Data Operation**: Similar to database merge/upsert operations
- **Existing Records**: Preserved if no matching record in import file
- **Import Records**: 
  - Records matching existing ones (same subname + type) are updated
  - New records not in zone are created
- **Best For**: Configuration updates, partial zone modifications

#### 3. Replace Mode
- **Behavior**: Replace all existing records with imported ones
- **Use Case**: Complete zone replacement or migration scenarios
- **Data Operation**: Similar to replacing an entire dataset
- **Existing Records**: Deleted (except critical NS and SOA records)
- **Import Records**: All records are imported to clean zone
- **Best For**: Zone migration, complete configuration replacement
- **⚠️ Warning**: This is a destructive operation - use with caution

### Target Zone Selection

You can specify which zone to import records into:

- **Use zone from file**: Import to the zone name specified in the import file
- **Select existing zone**: Choose from a dropdown of your existing zones
- **Custom zone name**: Enter a specific zone name (zone will be created if it doesn't exist)

### Import Behavior

#### Zone Creation
- If the target zone doesn't exist, it will be created automatically
- Zone creation works for all import modes
- Minimum TTL and other zone settings are taken from the import file

#### Record Handling
- Record processing depends on the selected import mode (see above)
- Individual record failures don't stop the entire import
- Summary shows successful vs. failed record counts with mode-specific details
- Critical DNS records (NS, SOA) are protected during Replace mode

#### Error Handling
- Graceful handling of API errors and network issues
- Detailed progress reporting during import operations
- Comprehensive success/failure reporting with record counts
- Detailed error logs available in the application log

### Import File Requirements

#### JSON Format
- Must contain `zone` and `records` objects
- Zone must have at least a `name` field
- Records must have `subname`, `type`, `ttl`, and `records` fields

#### YAML Format
- Same structure as JSON but in YAML syntax
- Supports comments and multi-line strings
- More human-readable than JSON

#### BIND Zone Files
- Must contain `$ORIGIN` directive for zone name
- Supports `$TTL` directive for default TTL
- Standard BIND record syntax required
- Comments (lines starting with `;`) are ignored

#### djbdns/tinydns Format
- Supports basic record types: A, AAAA, CNAME, MX, TXT, NS
- Lines starting with `#` are treated as comments
- Format: `+fqdn:ip:ttl` for A records, `Cfqdn:target:ttl` for CNAME, etc.

## Use Cases and Workflows

### 1. Backup and Disaster Recovery
```bash
# Regular backup workflow
1. Export all zones to JSON format with metadata
2. Store backups in version control or secure storage
3. In case of data loss, import from backup files
```

### 2. Infrastructure-as-Code
```bash
# DevOps workflow
1. Export zones to YAML format without metadata
2. Store in Git repository with infrastructure code
3. Use CI/CD pipelines to deploy DNS changes
4. Import updated configurations after code reviews
```

### 3. DNS Provider Migration
```bash
# Migration workflow
1. Export from current provider to BIND format
2. Review and clean up exported data
3. Import to deSEC using the Import/Export dialog
4. Verify all records imported correctly
```

### 4. Environment Synchronization
```bash
# Multi-environment setup
1. Export production zone configuration
2. Modify for staging environment (different IPs, etc.)
3. Import to staging profile
4. Keep environments in sync through exports/imports
```

## Best Practices

### Export Best Practices
1. **Regular Backups**: Export zones regularly with metadata for complete backups
2. **Version Control**: Use YAML format for version-controlled configurations
3. **Documentation**: Include metadata when exporting for documentation purposes
4. **Clean Exports**: Exclude metadata when migrating to other DNS providers

### Import Best Practices
1. **Always Preview**: Use the preview function before importing
2. **Test Environment**: Import to a test zone first when possible
3. **Backup First**: Export existing zones before importing new data
4. **Validate Data**: Review imported data after successful import

### File Management
1. **Naming Convention**: Use descriptive filenames with dates
   - `example-com-backup-2025-08-10.json`
   - `staging-dns-config-v1.2.yaml`
2. **Organization**: Keep exports organized by environment/purpose
3. **Security**: Protect backup files as they contain DNS infrastructure data

## Troubleshooting

### Common Export Issues

#### "Zone not found in cache"
- **Cause**: Zone not loaded in application
- **Solution**: Refresh zones or sync with API first

#### "No records found for zone"
- **Cause**: Zone has no records or records not cached
- **Solution**: Select the zone in the main window to load records

### Common Import Issues

#### "File not found"
- **Cause**: Invalid file path or file moved
- **Solution**: Verify file exists and is accessible

#### "Import failed: Invalid format"
- **Cause**: File format doesn't match selected format
- **Solution**: Verify file format and select correct import format

#### "Failed to create zone"
- **Cause**: API error or invalid zone name
- **Solution**: Check zone name validity and API connectivity

#### "Some records failed to import"
- **Cause**: Invalid record data or API limitations
- **Solution**: Review application logs for specific error details

### Performance Considerations

#### Large Zone Exports
- Exports are processed in background threads
- Large zones may take several seconds to export
- Progress is shown during the operation

#### Large Zone Imports
- Imports are processed record by record
- Large imports may take time due to API rate limits
- Progress and status are shown during import

## API Integration

### Programmatic Access
The Import/Export functionality can be used programmatically:

```python
from import_export_manager import ImportExportManager

# Initialize manager
manager = ImportExportManager(api_client, cache_manager)

# Export a zone
success, message = manager.export_zone(
    zone_name="example.com",
    format_type="json",
    file_path="/path/to/backup.json",
    include_metadata=True
)

# Import a zone
success, message, preview = manager.import_zone(
    file_path="/path/to/import.json",
    format_type="json",
    dry_run=False
)
```

### Batch Operations
For batch operations, consider:
1. Using the JSON format for fastest processing
2. Implementing retry logic for failed operations
3. Processing zones sequentially to avoid API rate limits

## Future Enhancements

### Planned Features
- **Format Auto-Detection**: Automatically detect file format
- **Batch Import/Export**: Process multiple zones at once
- **Incremental Sync**: Import only changed records
- **Template Support**: Export/import with variable substitution
- **Validation Rules**: Custom validation for imported data

### Integration Opportunities
- **CI/CD Integration**: Command-line tools for automated workflows
- **Cloud Storage**: Direct export to cloud storage services
- **Monitoring**: Integration with monitoring systems for backup verification

## Security Considerations

### Data Protection
- Export files contain sensitive DNS configuration data
- Store backup files securely with appropriate access controls
- Consider encrypting backup files for long-term storage

### Access Control
- Import/Export operations require API access
- Ensure proper authentication and authorization
- Monitor import/export activities in application logs

---

For additional support or questions about Import/Export functionality, please refer to the main README.md or open an issue in the project repository.
